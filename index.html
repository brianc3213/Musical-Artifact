<!DOCTYPE html>
<html lang="en">


    <link rel="stylesheet" type="text/css" href="table_css.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
    <script language="JavaScript" src="https://code.jquery.com/jquery-1.11.1.min.js" type="text/javascript"></script>
    <script language="JavaScript" src="https://cdn.datatables.net/1.10.4/js/jquery.dataTables.min.js" type="text/javascript"></script>
    <script language="JavaScript" src="https://cdn.datatables.net/plug-ins/3cfcc339e89/integration/bootstrap/3/dataTables.bootstrap.js" type="text/javascript"></script>
    <link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/plug-ins/3cfcc339e89/integration/bootstrap/3/dataTables.bootstrap.css">

    <script>
        $(document).ready(function(){        
            console.log('make table');

            var topChartsPath = "https://veevveq2j8.execute-api.us-east-1.amazonaws.com/default/gtmsongs/topCharts"
            var xhttp = new XMLHttpRequest();
            xhttp.onreadystatechange = function() {
                if (this.readyState == 4 && this.status == 200) {
                    if(this.responseText == 'failed') {
                        alert("Login failed")
                        document.getElementById("Login").innerHTML = "Login";
                    } else {
                        console.log(this.responseText)
                        var data = JSON.parse(this.responseText)

                        var rows = document.getElementById('rows')
                        rows.innerHTML = ''

                        //data.foreach(row);
                        for (var i = 0; i < data.Count; i++) {
                            var newRow = document.createElement('tr')

                            var trackNumber = document.createElement('td')
                            trackNumber.innerHTML = i + 1
                            var title = document.createElement('td')
                            title.innerHTML = data.Songs[i].artist
                            var artist = document.createElement('td')
                            artist.innerHTML = data.Songs[i].title
                            var votes = document.createElement('td')
                            votes.innerHTML = data.Songs[i].votes
                            var emotions = document.createElement('td')
                            emotions.innerHTML = data.Songs[i].emotion
                            var genre = document.createElement('td')
                            genre.innerHTML = data.Songs[i].genre
                            // var newP = document.createElement('p')
                            // newP.setAttribute('data-placement', "top") 
                            //newP.setAttribute('data-toggle', "tooltip")
                            //newP.setAttribute('title', "Edit")


                            newRow.appendChild(trackNumber)
                            newRow.appendChild(title)
                            newRow.appendChild(artist)
                            newRow.appendChild(votes)
                            newRow.appendChild(emotions)
                            newRow.appendChild(genre)


                            rows.append(newRow);
                        }


                    }
                } else if(this.readyState == 4 && this.status == 404) {
                    alert("failed")
                }
            };
            xhttp.open("GET", topChartsPath, true);
            xhttp.send()

            if(!checkCookie()) {
                window.location = "./login.html"
            } else {
                var token = getCookie("token")
                console.log(token)
                var username = token.split("%");
                console.log(username[0])
                $("#user").html(username[0]);
                $("#user").attr({
                    "href" : null,
                });
                $("#register").html(null)

            }
        });

        function getCookie(cname) {
            var name = cname + "=";
            var ca = document.cookie.split(';');
            for(var i = 0; i < ca.length; i++) {
                var c = ca[i];
                while (c.charAt(0) == ' ') {
                    c = c.substring(1);
                }
                if (c.indexOf(name) == 0) {
                    return c.substring(name.length, c.length);
                }
            }
            return "";
        }

        function checkCookie() {
            var token = getCookie("token");
            if (token !== "") {
                return true
            } else {
                return false
            }
        }
    </script>

    <script>
        $(document).ready(function() {
            //$('#datatable').dataTable();
            $("[data-toggle=tooltip]").tooltip();
        });
    </script>


    <head>
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <title>Musical Artifact</title>
        <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css">
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.3/umd/popper.min.js"></script>
        <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.1.3/js/bootstrap.min.js"></script>
    </head>

    <body>

        <!--<style>-->
            <!--.pagination {-->
                <!--display: inline-block;-->
            <!--}-->
            <!--.pagination a {-->
                <!--color: black;-->
                <!--float: left;-->
                <!--padding: 8px 16px;-->
                <!--text-decoration: none;-->
                <!--transition: background-color .3s;-->
                <!--border: 1px solid #ddd;-->
            <!--}-->
            <!--.pagination a.active {-->
                <!--background-color: #4CAF50;-->
                <!--color: white;-->
                <!--border: 1px solid #4CAF50;-->
            <!--}-->
            <!--.pagination a:hover:not(.active) {background-color: #ddd;}-->
        <!--</style>-->
        <!---->
        <nav class="navbar navbar-dark sticky-top bg-dark flex-md-nowrap p-0">
            <a class="navbar-brand col-sm-3 col-md-2 mr-0" href="#">Buzzy Beats</a>
            <ul class="navbar-nav px-3">
                <li class="nav-item text-nowrap">
                    <a id="user" style="color:white"></a>

                    <a class="nav-link" href="logout.html" id="logout" style="color:white">Sign out</a>
                </li>
            </ul>
        </nav>

        <div class="container">



            <div class="row" style="margin-top: 5%">
                <div class="col-sm-8"><h2 class="text-center">Top 100 Music</h2></div>
                <div class="col-sm-4"><button class="btn btn-primary btn-sm" id="search" onclick="location.href = 'search.html'">Post</button></div>
            </div>

            <div class="row">
                <div class="col-md-12">
                    <table id="datatable" class="table table-striped table-bordered .thead-dark" cellspacing="0" width="100%">
                        <thead>
                            <tr>
                                <th>Rank</th>
                                <th>Songs</th>
                                <th>Artists</th>
                                <th>Votes</th>
                                <th>Emotions</th>
                                <th>Genre</th>
                            </tr>
                        </thead>

                        <tbody id="rows">

                        </tbody>

                    </table>
                </div>
                
                <!--<div class="pagination">-->
                  <!--<a href="#">&laquo;</a>-->
                  <!--<a href="#">1</a>-->
                  <!--<a href="#" class="active">2</a>-->
                  <!--<a href="#">3</a>-->
                  <!--<a href="#">4</a>-->
                  <!--<a href="#">5</a>-->
                  <!--<a href="#">6</a>-->
                  <!--<a href="#">&raquo;</a>-->
                <!--</div>-->
            </div>

        </div>


    </body>

</html>

